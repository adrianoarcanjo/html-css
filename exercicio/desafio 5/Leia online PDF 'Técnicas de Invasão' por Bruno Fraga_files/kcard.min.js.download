/* Copyright (c) 2021 Amazon.com, Inc. or its affiliates. All Rights Reserved. */
!function(){function a(a){a&&a.setAttribute("hidden",!0)}function b(a){a&&a.removeAttribute("hidden")}function c(a){return a.hasAttribute("hidden")}function d(a){a&&("remove"in Element.prototype?a.remove():a.parentNode.removeChild(a))}function e(a){ha.recordAction(ia.CONTEXT_BOOKCARD,ia.ACTION_PREVIEW_BOOK_CLICKED,{previewType:X}),ha.recordPMET(ha.createMetricName(ia.ACTION_PREVIEW_BOOK_CLICKED,ia.CONTEXT_BOOKCARD,X))}function f(){return location.origin||location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}function g(c){ha.recordAction(ia.CONTEXT_BOOKCARD,ia.ACTION_PREVIEW_BOOK_CLICKED,{previewType:L}),ha.recordPMET(ha.createMetricName(ia.ACTION_PREVIEW_BOOK_CLICKED,ia.CONTEXT_BOOKCARD,L)),a(M),m(),b(V),V.focus(),da=!0,j()&&!fa&&(ca?(h(window.performance.now()),fa=!0):ea=window.performance.now()),setTimeout(function(){d(M)},Z),c.preventDefault()}function h(a){V&&V.contentWindow&&V.contentWindow.postMessage(JSON.stringify({readerShowTime:a}),f())}function i(){return N.href}function j(){return window.KindleGlobal.requestInfo.embedPreviewMode===L}function k(){function a(){return!!c.match(/iPad|iPhone|iPod/i)&&!c.match(/Safari/i)&&!window.navigator.standalone}function b(){return!(!c.match(/Android/i)||!c.match(/Twitter|WhatsApp|FB_IAB\/FB4A|WebView|; wv[);]/)&&!window._cordovaNative)}var c=window.navigator.userAgent;return a()||b()}function l(){return-1!==window.navigator.userAgent.indexOf("Firefox")}function m(){if(!V){var b=B,c=KindleGlobal.deviceInfo;"IE"===c.browserFamily&&c.majorVersion<=10&&(b+=" "+C),V=document.createElement("iframe"),V.className=b,V.width="100%",V.height="100%",V.setAttribute("allowfullscreen",!0),a(V),document.body.appendChild(V),W=setTimeout(n,_),window.on("message",function(a){if(a.origin===f())try{var b=JSON.parse(a.data);b.action&&"notifyLoaded"===b.action&&clearTimeout(W),b.event&&"readerLoading"===b.event&&(ca=!0,da&&!fa&&(h(ea),fa=!0))}catch(c){}}),V.src=i()}}function n(){var a=V.src;V.src="",V.src=a}function o(){if(T){var a=T.value;q("https://"+window.location.hostname+"/kp/share/getShareUrl"+window.location.search+"&kpShareUrl="+encodeURIComponent(a),a,"tinyUrl",function(a){T.value=a,T.select()})}}function p(){var a=KindleGlobal.basicShareUrl;q("https://"+window.location.hostname+"/kp/share/getMailtoShareUrl"+window.location.search+"&kpShareUrl="+encodeURIComponent(a)+"&requestId="+KindleGlobal.requestInfo.requestId,a,"mailtoUrl",function(a){$(G).setAttribute("href",a)})}function q(a,b,c,d){ga[b]?d(ga[b]):s(a,"GET",function(a){var e=JSON.parse(a.responseText)[c];ga[b]=e,ga[e]=e,d(e)})}function r(a){a.preventDefault();var b=a.target.getAttribute("data-channel");window.open(a.target.getAttribute("href"),b,"width=650 height=450")}function s(a,b,c){var d=new XMLHttpRequest;d.open(b,a,!0),d.onreadystatechange=function(){4==d.readyState&&200==d.status&&c&&c(d)},d.send()}function t(){O.on("click",e),N.on("click",g),P&&P.on("click",function(){ha.recordAction(ia.CONTEXT_BOOKCARD,ia.ACTION_BUY_CLICKED)}),Q&&Q.on("click",function(){b(R),T&&T.select(),o(),p(),ha.recordAction(ia.CONTEXT_BOOKCARD,ia.ACTION_SHARE_CLICKED),ha.recordShowContext(ia.CONTEXT_SHARING_DIALOG)}),S&&l()&&S.on("click",function(a){a.preventDefault();var b=$(G).getAttribute("href");b&&(window.top.location.href=b)})}function u(){function b(b){a(R),ha.recordHideContext(ia.CONTEXT_SHARING_DIALOG,{mechanism:b})}R&&(k()&&a($(K)),U.on("click",function(){b(ia.ACTION_CLOSE_CLICKED)}),window.on("resize",function(){v()}),R.on("click",function(a){a.target===R&&b(ia.ACTION_OVERLAY_CLICKED)}),document.body.on("keydown",function(a){switch(a.which){case 27:c(shareOverlay)||b(ia.ACTION_ESC_PRESSED)}}),T&&T.on("click",function(){T.select()}),window.KindleGlobal.deviceInfo.isDesktop&&($(".kp-share-icon-facebook").on("click",r),$(".kp-share-icon-twitter").on("click",r)),R.on("click",function(a){if(a.target.classList.contains(J)){var b=ia.CONTEXT_SHARING_DIALOG,c=ia.ACTION_SHARE_CHANNEL_CLICKED,d=a.target.getAttribute("data-channel"),e=ha.createMetricName(c,b,d);ha.recordAction(b,c,{channel:d},e),ha.recordPMET(ha.createMetricName(c,b))}}))}function v(){window.innerWidth<Y?(a(R),a(shareOverlay)):b(shareOverlay)}function w(){M=$(x),N=$(y),O=$(z),P=$(A),Q=$(D),shareOverlay=$(E),R=$(F),S=$(G),T=$(I),U=$(H),ha.recordShowContext(ia.CONTEXT_BOOKCARD),t(),u(),j()&&window.KindleGlobal.deviceInfo.isDesktop&&window.innerHeight>=ba&&window.innerWidth>=aa&&m(),v()}var x=".kp-bookcard-container",y=".kp-bookcard-inline-button",z=".kp-bookcard-newtab-button",A="#kp-bookcard-action-buy",B="kp-bookcard-inline-reader",C="kp-bookcard-inline-reader-hide-behind",D="#kp-bookcard-action-share",E=".kp-share-overlay",F=".kp-share-overlay-container",G=".kp-share-icon-email",H=".kp-close-icon",I=".kp-share-link-input",J="kp-share-link",K=".kp-share-system-msg";const L="inline";var M,N,O,P,Q,R,S,T,U,V,W,X="newtab",Y=256,Z=1500,_=15e3,aa=334,ba=548,ca=!1,da=!1,ea=null,fa=!1,ga={};window.$=document.querySelector.bind(document),Node.prototype.on=window.on=function(a,b){this.addEventListener(a,b)};var ha=function(){function a(){return parseInt(v[u]||"0",10)}function b(a){v[u]=a,window.localStorage.setItem(t,JSON.stringify(v))}function c(){var a={};return a.Version=window.KindleGlobal.appStaticVersion,a.Browser=d(),a.RefTag=e(),a.AssociateTag=f(),a.EmbedPreviewMode=window.KindleGlobal.requestInfo.embedPreviewMode,a}function d(){var a=window.KindleGlobal.deviceInfo;return a.name.toLowerCase().split(" ")[0]+"@"+a.version.split(".")[0]}function e(){return window.KindleGlobal.requestInfo&&window.KindleGlobal.requestInfo.refTag||"k4w_no_ref"}function f(){return window.KindleGlobal.requestInfo&&window.KindleGlobal.requestInfo.associateTag}function g(){for(var a=arguments[0],b=1;b<arguments.length;b++)a+=q+arguments[b];return a}function h(d){if(d.pmetMetrics||d.rsMetrics){var e=a(),f={devicePlatform:window.KindleGlobal.amazonDeviceType+":"+window.KindleGlobal.deviceInfo.deviceType,clientName:window.KindleGlobal.serviceName||"KindlePlayer",version:window.KindleGlobal.appStaticVersion,versionForCapability:window.KindleGlobal.appVersionForReadingStreams,versionForRS:window.KindleGlobal.appVersionForReadingStreams,messageNumber:e,sessionId:window.KindleGlobal.requestInfo.sId,metricBreakdown:c(),metrics:d.pmetMetrics,readingStreamsMetrics:d.rsMetrics,marketplace:window.KindleGlobal.marketplace,pfm:window.KindleGlobal.pfm},g=new XMLHttpRequest;g.open("POST",s),g.setRequestHeader("Amzn-Device-Type",window.KindleGlobal.amazonDeviceType),g.setRequestHeader("Content-Type","application/json"),g.send(JSON.stringify({Input:f,Operation:"uploadMetricsExternal"})),b((e+1).toString())}}function i(a,b){return b=b||{},b.requestId=window.KindleGlobal.requestInfo.requestId,{context:a,timestamp:Date.now(),metadataMap:b}}function j(a,b,c,d){var e=i(a,c);e.type=o.action,e.actionId=b,h({pmetMetrics:[m(d||g(b,a))],rsMetrics:[JSON.stringify(e)]})}function k(a,b){var c=i(a,b);c.type=o.showContext,h({pmetMetrics:[m(g("Viewed",a))],rsMetrics:[JSON.stringify(c)]})}function l(a,b){var c=i(a,b);c.type=o.hideContext,h({pmetMetrics:[m(g(b.mechanism,a))],rsMetrics:[JSON.stringify(c)]})}function m(a){return{method:a,time:0,breakdown:Object.keys(c()),counters:[],timers:[]}}function n(a){h({pmetMetrics:[m(a)]})}var o={showContext:"ShowContext",hideContext:"HideContext",action:"Action"},p={CONTEXT_BOOKCARD:"BookCard",CONTEXT_SHARING_DIALOG:"SharingDialog",ACTION_SHARE_CHANNEL_CLICKED:"ShareChannelClicked",ACTION_CLOSE_CLICKED:"CloseClicked",ACTION_OVERLAY_CLICKED:"OverlayClicked",ACTION_BUY_CLICKED:"BuyClicked",ACTION_PREVIEW_BOOK_CLICKED:"PreviewBookClicked",ACTION_SHARE_CLICKED:"ShareClicked",ACTION_ESC_PRESSED:"KeyPressed::Escape"},q="::",r=window.KindleGlobal.srsBaseHref||"https://"+window.location.hostname+"/service/web/",s=r+"content/uploadMetrics",t="KindlePlayer",u="messageNumber",v=window.localStorage.getItem(t)&&JSON.parse(window.localStorage.getItem(t))||{};return{CONSTANTS:p,recordPMET:n,createMetricName:g,recordAction:j,recordShowContext:k,recordHideContext:l}}(),ia=ha.CONSTANTS;!function(){function a(a){return window.KindleGlobal.weblabs?window.KindleGlobal.weblabs[a]:null}function b(a){if(!(d.indexOf(a)>=0)){s("https://"+location.hostname+"/kp/weblab/trigger/"+a+"?requestId="+KindleGlobal.requestInfo.requestId+"&"+(location.search||"").slice(1),"POST",function(){d.push(a)})}}function c(c){var d=a(c);return d&&b(c),d}var d=[]}();w()}();